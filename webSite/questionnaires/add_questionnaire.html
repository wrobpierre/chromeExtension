<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="../css/questionnaire.css">
	<title>Add a questionnaire</title>
<!-- 	<style type="text/css">
	.all_questions {
		margin: 0 0 30px 0;
	}

	.error {
		color:red;
	}

	select {
		display: block;
		margin: 20px 0 20px 0;
	}

	div.selector + p {
		display: inline;
	}
</style> -->
</head>
<body>
	<header class="parallax-window" data-parallax="scroll" data-image-src="../img/header_question.jpg"></header>
	<form action="management_questionnaire.php" method="post">
		<div id="form-questionnaire">
			<div id="questionnaire">
				<h1>Add a questionnaire</h1>
				<hr>
				<input type="hidden" name="action" value="add"><br>
				<label>Enter the title of your questionnaire&nbsp;:&nbsp;</label>
				<span class="error"></span>
				<input class="input_question" type="text" name="title"><br>
				<label>Choose the type of your questionnaire&nbsp;:&nbsp;</label>
				<select class="select_question" name="type">
					<option value="article">Article</option>
					<option value="image">Image</option>
				</select>
				<div class="selector">
					<label>Link to your Article&nbsp;:&nbsp;</label><span class="error"></span>
					<input class="input_question" type="text" name="data">
				</div>
				<p>Your questions&nbsp;:</p>
				<input class="button" type="button" value="add question">
				<span class="error"></span><br>
				<div class="all_questions">

				</div>
				<input class="button_valid" type="submit" value="send">

			</div>
		</div>
	</form>

	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){
			var i = 0;
			$('.select_question').change(function(){
				if( $('.select_question option:selected').text() == "Article" ) {
					$('.selector').find('label').text('Link to your Article : ');
				}
				else if ( $('.select_question option:selected').text() == "Image" ) {
					$('.selector').find('label').text('Link to your Image : ');
				}
			});

			$('input[value="add question"]').click(function(){
				var div = $('<div id="'+i+'"></div>').attr('class','question');
				var lq = $('<label>Question&nbsp;:&nbsp;</label> <span class="error"></span>');
				var iq = $('<input class="input_question" type="text" name="q['+i+'][question]"><br>');

				var lt = $('<label>Type of question : </label> <span class="error"></span>');
				var select = $('<select class="select_type" name="q['+i+'][type_ques]">'
					+'<option></option>'
					+'<option value="text">TEXT</option>'
					+'<option value="number">NUMBER</option>'
					+'<option value="interval">INTERVAL</option>'
					+'</select>');
				select.change(function(){
					$(this).next().empty();
					var id_parent = $(this).parent().attr('id');
					if ( $(this).find(':selected').text() == "" ) {
						$(this).next().empty();
					}
					else if ( $(this).find(':selected').text() == "TEXT" ) {
						la = $('<label>Answer&nbsp;(put a list of words separated by a comma without spaces, eg: apple,pear,banana,...):&nbsp;</label><span class="error"></span>');
						ia = $('<input class="input_question" type="text" name="q['+id_parent+'][answer]"><br>');
						$(this).next().append(la,ia);
					}
					else if ( $(this).find(':selected').text() == "NUMBER" ) {
						la = $('<label>Answer&nbsp;(put a number):&nbsp;</label><span class="error"></span>');
						ia = $('<input class="input_question" type="number" step="any" name="q['+id_parent+'][answer]"><br>');
						particule_label = $('<label>Particule (eg:3 million instead of 3 000 000):&nbsp;</label>');
						particule_input = $('<input type="text" name="q['+id_parent+'][particule]">');
						$(this).next().append(la,ia,particule_label,particule_input);
					}
					else if ( $(this).find(':selected').text() == "INTERVAL" ) {
						la = $('<label>Answer&nbsp;(put the minimum in the first area and the max in the other. The values are include):&nbsp;</label><span class="error"></span>');
						min = $('<input class="input_question" type="number" step="any" name="q['+id_parent+'][min]"><label> to </label>')
						max = $('<input class="input_question" type="number" step="any" name="q['+id_parent+'][max]">')
						$(this).next().append(la,min,max);
					}
				});
				var answer = $('<div class="answer"></div>');

				var button = $('<input class="button_delete" type="button" value="delete question"><br>');
				button.click(function(){
					$(this).parent().remove();
				});
				var error = $('<span class="error"></span>');
				div.append(lq,iq,lt,select,answer,button,error,'<hr>');
				$('.all_questions').append(div);
				i += 1;
			})

			$('form').submit(function(){
				$('span.error').text('');
				valid = true;

				if ($('input[name="title"]').val() == "") {
					$('input[name="title"]').prev().text(' Missing title');
					valid = false;
				}

				if ($('input[name="data"]').val() == "") {
					$('input[name="data"]').prev().text(' Missing link');
					valid = false;
				}

				if( $('.all_questions')[0].children.length == 0 ) {
					$('input[value="add question"]').next().text('Please add at least one question');
					valid = false;
				}
				else {
					$('div.question').each(function(index, value){
						id = $(this).attr('id');
						if ($(this).find('input[name="q['+id+'][question]"]').val() == "") {
							$(this).find('input[name="q['+id+'][question]"]').prev().text('Missing question');
							valid = false;
						}
						if ($(this).find('select').find(':selected').text() == "") {
							$(this).find('select[name="q['+id+'][type_ques]"]').prev().text('Select the type of the question');
							valid = false;
						}
						else {
							if ($(this).find('select').find(':selected').text() == "TEXT" || $(this).find('select').find(':selected').text() == "NUMBER") {
								if ($(this).find('input[name="q['+id+'][answer]"]').val() == "") {
									$(this).find('input[name="q['+id+'][answer]"]').prev().text('Missing answer');
									valid = false;
								}
							}
							else if ($(this).find('select').find(':selected').text() == "INTERVAL") {
								if ($(this).find('input[name="q['+id+'][min]"]').val() == "" || $(this).find('input[name="q['+id+'][max]"]').val() == "") {
									$(this).find('input[name="q['+id+'][min]"]').prev().text('Missing min or max');
									valid = false;
								}	
							}
						}
					});
				}

				return valid;
			})
		});
	</script>
	<script src="../js/parallax.js-1.5.0/parallax.js"></script>
</body>
</html>