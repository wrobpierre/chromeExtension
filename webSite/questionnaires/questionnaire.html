<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="../css/questionnaire.css">
	<meta charset="utf-8">
	<title></title>
</head>
<body>
	<header class="parallax-window" data-parallax="scroll" data-image-src="../img/select_question.jpg"></header>
	<div id="form-questionnaire">
		<div id="questionnaire">
			<div id="content">
				
				<h1></h1>


			</div>
		</div>
	</div>
	
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script type="text/javascript">
		function getUrlParameter(sParam) {
			var sPageURL = decodeURIComponent(window.location.search.substring(1)),
			sURLVariables = sPageURL.split('&'),
			sParameterName,
			i;

			for (i = 0; i < sURLVariables.length; i++) {
				sParameterName = sURLVariables[i].split('=');

				if (sParameterName[0] === sParam) {
					return sParameterName[1] === undefined ? true : sParameterName[1];
				}
			}
		};
		var param = getUrlParameter('id');
		
		if (param == undefined) {
			//var post = $.post('http://localhost/chromeExtension/webSite/questionnaires/management_questionnaire.php', { key:"all" });
			var post = $.post('http://163.172.59.102/webSite/questionnaires/management_questionnaire.php', { action:"all" });

			post.done(function(data){
				var dataParse = JSON.parse(data);
				document.title = 'Questionnaires';
				$('h1').text('List of questionnaires');
				var ul = $('<ul></ul>');
				ul.css("list-style", "none")
				$.each(dataParse, function(index, value){
					var li = $('<li class="list_question"></li>');
					var divEdit = $('<div class="button_link"></div>');
					var divA = $('<div class="button_link"></div>');
					var a = $('<a class="link"></a>').attr('href', value['url']).text(value['title']).css('margin','0 15px 0 0');
					var edit = $('<a class="link"></a>').attr('href', 'http://163.172.59.102/webSite/questionnaires/edit_questionnaire.html?id='+value['url'].split('=')[1]).text('edit');

					var del = $('<button class="button_delete">Delete</button>').click(function(){
						var r = confirm("Are you sure to delete this questionnaire ?");
						if (r == true) {
							var postDel = $.post('http://163.172.59.102/webSite/questionnaires/management_questionnaire.php', { action:"delete", url:value['url'] });
							postDel.done(function(data){
								alert(data);
							});
						}
					});
					divA.append(a);
					divEdit.append(edit);
					li.append(divA,divEdit,del);
					ul.append(li);
				})

				var div = $('<div class="button_link"></div>');

				var add = $('<a class="link" href="http://163.172.59.102/webSite/questionnaires/add_questionnaire.html">Add a questionnaire</a>');

				div.css("background-color", "#00B16A");
				div.css("height", "40px");

				div.append(add);
				$('#content').append(ul,div);
			});
		}
		else {
			//var post = $.post('http://localhost/chromeExtension/webSite/questionnaires/management_questionnaire.php', { key:"get_questions", id:param });
			var post = $.post('http://163.172.59.102/webSite/questionnaires/management_questionnaire.php', { action:"get_questions", id:param });

			post.done(function(data){
				var dataParse = JSON.parse(data);
				console.log(dataParse);
				document.title = dataParse[0]['title'];
				$('h1').text(dataParse[0]['title']);
				var link;
				if (dataParse[0]['type'] == 0) {
					link = $('<a target="_blank"></a>').attr('href', dataParse[0]['link']).text(dataParse[0]['link']);
				}
				else {
					link = $('<img>').attr('src', dataParse[0]['link']).attr('alt', dataParse[0]['link']);	
				}
				var form = $('<form method="post" action="checkAnswers.php"></form>');
				var user_id = $('<input type="hidden" name="user_id">');
				form.append(user_id);	
				
				for (var i = 0; i < dataParse.length; i++) {
					var div = $('<div class="question" id="'+(i+1)+'"></div>');
					var p = $('<p>'+dataParse[i]['question']+'</p>');
					var input = $('<input class="input_question" type="text" name="q['+dataParse[i]['id']+']">');
					var valid = $('<input class="button" type="button" value="valid">');

					div.css("margin", "5%");
					div.append(p,input,valid);
					form.append(div);
				}


				var lastDiv = $('<div></div>')
				var p = $('<p>Don\'t forget to send your questionnaire and to press the button "stop"</p>');
				var submit = $('<input class="button_valid" type="submit" value="send">');
				lastDiv.css("margin", "5%")

				lastDiv.append(p,submit);
				form.append(lastDiv);
				$('#form-questionnaire').css("width","100%");
				$('#content').css("text-align", "center")
				form.css("margin-top","0px");
				$('#content').append(link);
				$('#content').append(form);

				$(document).ready(function(){

					$('div.question[id!=1]').css('display','none');
					$('form div:last-child').css('display','none');

					alert("Don't forget to press the button \"start\" when you become your research !");

					$('input[type="button"]').click(function(){
						$(this).parent().css('display','none');
						$(this).parent().next().css('display','block');
					})

					$('form').submit(function(){
						alert('Thanks for your participation !')
						//return false;
					});
				});
			});
		}
	</script>
	<script src="../js/parallax.js-1.5.0/parallax.js"></script>
</body>
</html>